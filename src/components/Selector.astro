---
/**
 * Selector Component
 *
 * Toggle component for switching between Projects and Publications sections.
 * Only one section is visible at a time based on the active button.
 */
import { BookOpen, Code2 } from 'lucide-astro';
import { ICON_SIZES, SELECTOR } from '../constants/ui';
---

<section id="selector" class="container mx-auto px-6 mt-12">
    <div class="flex justify-center items-center gap-4 pb-4" role="tablist" aria-label="Content selector">
        <button
            id="projects-btn"
            role="tab"
            aria-controls="projects-section"
            aria-selected="true"
            aria-label="Show projects"
            class="selector-btn active inline-flex items-center gap-2 px-6 py-2 rounded-full font-medium transition-all duration-200 bg-selector-active text-selector-active-text border-0"
            data-target="projects"
        >
            <Code2 size={ICON_SIZES.MD} aria-hidden="true" />
            Projects
        </button>
        <button
            id="publications-btn"
            role="tab"
            aria-controls="publications-section"
            aria-selected="false"
            aria-label="Show publications"
            class="selector-btn inline-flex items-center gap-2 px-6 py-2 rounded-full font-medium transition-all duration-200 bg-transparent text-text dark:text-text-dark border-0"
            data-target="publications"
        >
            <BookOpen size={ICON_SIZES.MD} aria-hidden="true" />
            Publications
        </button>
    </div>
    <hr class="border-t border-gray-300 dark:border-gray-600" />
</section>

<script>
    // Selector toggle logic
    function initSelector() {
        const projectsBtn = document.getElementById('projects-btn') as HTMLButtonElement;
        const publicationsBtn = document.getElementById('publications-btn') as HTMLButtonElement;
        const projectsSection = document.getElementById('projects-section');
        const publicationsSection = document.getElementById('publications-section');

        if (!projectsBtn || !publicationsBtn || !projectsSection || !publicationsSection) {
            return;
        }

        function setActive(activeBtn: HTMLButtonElement, inactiveBtn: HTMLButtonElement) {
            // Update button styles - active has colored background, inactive is transparent
            activeBtn.classList.remove('bg-transparent', 'text-text', 'dark:text-text-dark');
            activeBtn.classList.add('bg-selector-active', 'text-selector-active-text', 'active');
            activeBtn.setAttribute('aria-selected', 'true');

            inactiveBtn.classList.remove('bg-selector-active', 'text-selector-active-text', 'active');
            inactiveBtn.classList.add('bg-transparent', 'text-text', 'dark:text-text-dark');
            inactiveBtn.setAttribute('aria-selected', 'false');
        }

        function showSection(section: 'projects' | 'publications', updateUrl = true, cardId?: string) {
            if (section === 'projects') {
                setActive(projectsBtn, publicationsBtn);
                projectsSection.classList.remove('hidden');
                publicationsSection.classList.add('hidden');
                if (updateUrl) {
                    const hash = cardId ? `#projects/${cardId}` : '#projects';
                    history.pushState(null, '', hash);
                }
            } else {
                setActive(publicationsBtn, projectsBtn);
                publicationsSection.classList.remove('hidden');
                projectsSection.classList.add('hidden');
                if (updateUrl) {
                    const hash = cardId ? `#publications/${cardId}` : '#publications';
                    history.pushState(null, '', hash);
                }
            }

            // Scroll to card if specified
            if (cardId) {
                setTimeout(() => {
                    const element = document.getElementById(cardId);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        element.classList.add('highlight-card');
                        setTimeout(() => element.classList.remove('highlight-card'), 2000);
                    }
                }, 100);
            }
        }

        function handleHash(hash: string) {
            if (!hash || hash === '#') {
                showSection('projects', false);
                return;
            }

            // Remove leading #
            const cleanHash = hash.substring(1);
            
            // Check for card-specific hash (e.g., #projects/project-jetpack-compose-starter)
            if (cleanHash.startsWith('projects/')) {
                const cardId = cleanHash.substring(9);
                showSection('projects', false, cardId);
            } else if (cleanHash.startsWith('publications/')) {
                const cardId = cleanHash.substring(13);
                showSection('publications', false, cardId);
            } else if (cleanHash === 'publications') {
                showSection('publications', false);
            } else {
                showSection('projects', false);
            }
        }

        projectsBtn.addEventListener('click', () => showSection('projects'));
        publicationsBtn.addEventListener('click', () => showSection('publications'));

        // Handle browser back/forward buttons
        window.addEventListener('popstate', () => {
            handleHash(window.location.hash);
        });

        // Initialize based on current URL hash
        handleHash(window.location.hash);
    }

    // Initialize on page load
    initSelector();

    // Re-initialize after page transitions (if using Astro view transitions)
    document.addEventListener('astro:page-load', initSelector);
</script>

<style define:vars={{ minWidth: `${SELECTOR.MIN_WIDTH}px` }}>
    .selector-btn {
        min-width: var(--minWidth);
        /* No shadows - clean flat design */
        box-shadow: none;
    }

    .selector-btn:hover {
        opacity: 0.8;
    }

    /* Visible focus indicator for keyboard navigation */
    .selector-btn:focus-visible {
        outline: 2px solid currentColor;
        outline-offset: 2px;
    }
</style>
